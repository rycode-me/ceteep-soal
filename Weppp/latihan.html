<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<title>LATIHAN CTF</title>
<style>
  body{font-family: Arial; background:#0d1117; color:#e6edf3; padding:20px;}
  h1{ text-align:center; margin-bottom:18px; }
  .box{background:#161b22;border:1px solid #30363d;padding:16px;border-radius:8px;margin-bottom:12px;}
  input{padding:8px;border-radius:6px;border:1px solid #30363d;background:#0d1117;color:white}
  button{padding:8px 12px;border-radius:6px;border:none;background:#238636;color:white;cursor:pointer}
  p.result{margin-top:8px;font-weight:bold}
  a.link-btn {
    display:inline-block;
    margin-top:8px;
    padding:6px 10px;
    background:#f1c40f;
    color:#0d1117;
    text-decoration:none;
    border-radius:6px;
    font-weight:700;
  }
  a.link-btn:hover { opacity:0.9; }
</style>
</head>
<body>
  <h1>LATIHAN CTF</h1>

  <div id="challenges"></div>

  <script>
  const keyPartsB64 = [
    "c3VwZXI=",   // "super"
    "c2VjcmV0",   // "secret"
    "a2V5"        // "key"
  ];

  const saltStr = "\x12\x34\x56";

  // FLAG sudah dienkripsi (XOR + BASE64)
  const encrypted = {
    1: "MghsNj1VEjpFGSFOFiMc",
    2: "MghsNj1GAjxRB2BNFiMAMls=",
    3: "MghsNj1VFjlFBDNOCg==",
    4: "MghsNj1IEjldFixcKCwDIEgQLVAfKg==",
    5: "MghsNj1REiVGFitcBTA=",
    6: "MghsNj1CGCRLGSdREiYc",
    7: "MghsNj1EGz9FGiRIGyQNLUcfGUcSJUEEME8SPgQvUhY1TE0TWQ==",
    8: "MghsNj1OFjpRGyFVKD4ANVNaNUQDIkoOIUA="

  };

  function b64ToBytes(b64) {
    const bin = atob(b64);
    const arr = new Uint8Array(bin.length);
    for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
    return arr;
  }

  function bytesToStr(bytes) {
    let s = "";
    for (let i = 0; i < bytes.length; i++) s += String.fromCharCode(bytes[i]);
    return s;
  }

  function strToBytes(s) {
    const arr = new Uint8Array(s.length);
    for (let i = 0; i < s.length; i++) arr[i] = s.charCodeAt(i);
    return arr;
  }

  function xorBytes(dataBytes, keyBytes) {
    const out = new Uint8Array(dataBytes.length);
    for (let i = 0; i < dataBytes.length; i++) {
      out[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
    }
    return out;
  }

  function buildKeyBytes() {
    let concat = "";
    for (let p of keyPartsB64) concat += atob(p);
    const concatBytes = strToBytes(concat);
    const saltBytes = strToBytes(saltStr);

    const keyBytes = new Uint8Array(concatBytes.length);
    for (let i = 0; i < concatBytes.length; i++) {
      keyBytes[i] = concatBytes[i] ^ saltBytes[i % saltBytes.length];
    }
    return keyBytes;
  }

  function decryptCiphertext(b64cipher) {
    try {
      const cipherBytes = b64ToBytes(b64cipher);
      const keyBytes = buildKeyBytes();
      const plainBytes = xorBytes(cipherBytes, keyBytes);
      return bytesToStr(plainBytes);
    } catch (e) {
      return "";
    }
  }

  // Link tiap soal ke folder lain
  const soalLinks = {
    1: "soal/soal1.html",
    2: "soal/soal2.html",
    3: "soal/soal3.html",
    4: "soal/soal4.html",
    5: "soal/soal5.html",
    6: "soal/soal6.html",
    7: "soal/soal7/soal7.html",
    8: "soal/soal8/soal8.html"
  };

  const challengesDiv = document.getElementById("challenges");
  for (let i = 1; i <= 8; i++) {
    const box = document.createElement("div");
    box.className = "box";
    box.innerHTML = `
      <div><strong>Challenge ${i}</strong></div>
      <a class="link-btn" href="${soalLinks[i]}" target="_blank">Buka Soal ${i}</a>
      <div style="margin-top:10px;">
        <input id="in${i}" placeholder="Masukkan flag (contoh: SIJA{...})" style="width:70%;">
        <button onclick="submitLocal(${i})">Submit</button>
        <p id="res${i}" class="result"></p>
      </div>
    `;
    challengesDiv.appendChild(box);
  }

  function submitLocal(id) {
    const user = document.getElementById("in" + id).value.trim();
    const res = document.getElementById("res" + id);

    if (!user) {
      res.textContent = "Input kosong!";
      res.style.color = "orange";
      return;
    }

    const real = decryptCiphertext(encrypted[id]);

    if (user === real) {
      res.textContent = "üéâ Benar! Flag diterima.";
      res.style.color = "lightgreen";
    } else {
      res.textContent = "‚ùå Ciaelah salahhüòú. coba lagi yak";
      res.style.color = "red";
    }
  }

  window.submitLocal = submitLocal;
  </script>
</body>
</html>
